# システム仕様書 (REQUIREMENTS.md)

## 1. アプリケーション概要
本システムは、子供（匠真）の学習習慣定着と読書記録の蓄積を目的とした、ゲーミフィケーション要素を取り入れたタスク管理アプリケーションである。

## 2. ユーザー役割

### 2.1 親 (Parent)
*   **権限**: 管理者権限
*   **機能**:
    *   **クエスト管理**: クエスト（タスク）の作成、編集、削除。
    *   **図書室管理**: 読書記録の閲覧、編集、削除（子供の記録内容を修正可能）。
    *   **データ出力**: クエストおよび読書記録の全データをCSV形式でエクスポート可能。
    *   **変更履歴**: 全ユーザーの操作履歴（Audit Log）はシステム内部で記録される。

### 2.2 子供 (Child: Shoma)
*   **権限**: 一般ユーザー
*   **機能**:
    *   **クエスト閲覧**: 自分に割り当てられたクエストの確認。
    *   **状態変更**: クエストを「TODO」から「DONE」へ変更可能（「できた！」ボタン）。
    *   **読書記録**: 新しい本の登録（タイトル、著者、URL、評価）。
    *   **UI特性**: マリオ等のゲームを意識した、視覚的に楽しいインターフェース。

## 3. 機能要件詳細

### 3.1 クエスト (Tasks)
*   **データ項目**:
    *   タイトル (必須)
    *   詳細 (任意)
    *   期限 (日付・時間)
    *   ステータス (TODO / DONE)
    *   作成日 / 完了日
*   **期限アラート**: 期限が近づくと残り時間を表示し、過ぎると「期限切れ」と警告表示を行う。

### 3.2 図書室 (Books)
*   **データ項目**:
    *   タイトル (必須)
    *   著者 (任意)
    *   参考URL (任意: Amazon等)
    *   評価 (1-5の星)
    *   OG情報 (自動取得: 画像、タイトル、説明)
*   **OG取得**: サーバーサイドでスクレイピングを行い、リンク先のメタデータを取得して表示する。`User-Agent`ヘッダーにてブラウザを模倣する。

### 3.3 変更履歴 (Audit Log)
*   **記録対象**: TaskおよびBookに対する CREATE / UPDATE / DELETE 操作。
*   **記録内容**: 操作日時、実行ユーザーID、操作種別、対象ID、変更内容（JSON）。
*   **保存先**: データベース内の `AuditLog` テーブル。

### 3.4 CSVエクスポート
*   **出力内容**: TasksテーブルとBooksテーブルの両方を含む。
*   **フォーマット**: UTF-8 (BOM付き) - Excelで文字化けせずに開ける形式。
*   **カラム**: ID, タイプ(クエスト/読書記録), タイトル, 詳細/著者, ステータス/評価, 期限/URL, 完了日/作成日, 担当。

## 4. 非機能要件
*   **パフォーマンス**: Next.js App Routerによる高速なページ遷移。
*   **データベース**: PostgreSQL (ローカル環境)。Prisma ORMによる型安全なアクセス。
*   **レスポンシブ**: デスクトップおよびタブレット/モバイルでの表示に対応。

## 5. 環境構成
*   **OS**: Windows
*   **Runtime**: Node.js
*   **DB**: PostgreSQL 15 (Localhost:5432)
